### 碰到的问题与心得

```
position: absolute;
/*position: relative;*/
```

在从零实现初期，最开始从后端获取弹幕json后直接全部一次性随机高度全部渲染。此时如果将span弹幕元素position改为relative可以轻松实现弹幕参差。后来加上消费者生产者函数机制后，也能实现弹幕参差，不过出现了弹幕跳动（因为后面的span标签会销毁）、弹幕滚动（因为屏幕中弹幕过多）的问题。后来在这里发现了问题所在，所以又改回absolute。



```
    setInterval(updateDanmu, 100);
    setInterval(addDanmu, 10);
```

*调试中发现，一段时间后弹幕只一行一行输出；控制台发现两个函数轮流一次调用。结合背景知识，怀疑是EventLoop调用出现了问题。*

在 JavaScript 中，事件循环（Event Loop）是一种机制，它负责处理 JavaScript 的异步任务。事件循环将异步任务按照注册顺序放入不同的任务队列中，然后按照规定的顺序执行任务队列中的任务。在事件循环的每一次迭代中，都会从一个任务队列中取出一个任务，执行它，然后进入下一次迭代。如果一个任务需要等待 I/O、定时器或者其它事件，那么它就会被挂起，直到满足了它的条件才会被放回任务队列中等待执行。

当两个函数的调用间隔很短时，它们可能会在同一时间间隔内同时触发。因为 JavaScript 是单线程执行的，这意味着事件循环只能执行一个任务，而不会在同一时间执行多个任务。所以，如果两个任务在同一时间间隔内触发，它们就会被放入同一个任务队列中，然后按照注册的顺序执行。因此，在调用间隔较短的情况下，两个函数调用的次数会趋于相等，因为它们的调用次数取决于它们在事件循环中的位置和执行时间。



```
在整个功能第一次写完以后，发现如果要再进行后期更改和维护，例如更改弹幕字体大小、全局变量的维护、重新进行后端返回的json数据进行抽取和处理时，发现script块处理和维护异常难。因此框架的出现确实合理。
```

```
最后，弹幕给出不均匀（要么就每次给很少一条一条给类似于现在实现的这样，要么就一波一波给齐头并起）。前者是因为消费生产设计有问题，后者是因为弹幕没有时间戳，消费生产是正常的，但是因为没有任何时间提示，所以消费函数会一股脑给出（而不延迟其中的任何一条）

另外，除了时间戳，还有其它例如在实际video中显示而不是黑框中、弹幕透明度、弹幕显示尺寸内容、实时调节弹幕大小等功能没有实现。
```

